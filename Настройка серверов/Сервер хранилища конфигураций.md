
---

### Шаг 1. Создаем пользователя для хранилища
Чтобы соблюдать наш принцип изоляции («одна задача — один пользователь»), создадим отдельного юзера. Он не должен иметь доступа к базам данных 1С, только к файлам хранилища.

```bash
# Создаем пользователя 1c_repo, добавляем в нашу общую группу grp1cv8
sudo useradd -r -g grp1cv8 -s /bin/false 1c_repo
```

### Шаг 2. Подготовка папки для данных
Хранилище — это файлы. Выделим под них место (лучше не в `/home`).

```bash
# Создаем каталог для всех будущих хранилищ
sudo mkdir -p /var/1c/repos

# Отдаем права нашему новому пользователю
sudo chown -R 1c_repo:grp1cv8 /var/1c/repos

# Ставим права 770 (только владелец и группа 1С могут зайти)
sudo chmod -R 770 /var/1c/repos
```

### Шаг 3. Создаем службу systemd (Автозапуск)
В инструкции по ссылке этого нет, а это самое важное. Хранилище должно подниматься само после перезагрузки сервера.

1.  Создай файл службы:
    `sudo nano /etc/systemd/system/1c-crserver.service`

2.  Вставь туда этот конфиг (проверь версию 1С в пути `ExecStart`!):
    ```ini
    [Unit]
    Description=1C:Enterprise Configuration Repository Server
    After=network.target

    [Service]
    Type=simple
    User=1c_repo
    Group=grp1cv8
    # -d указываем папку, где лежат хранилища
    # -port указываем порт (стандарт 1542)
    ExecStart=/opt/1cv8/x86_64/crserver -d /var/1c/repos -port 1542
    Restart=always
    RestartSec=5

    [Install]
    WantedBy=multi-user.target
    ```

### Шаг 4. Запуск и проверка
```bash
# Перечитываем список служб
sudo systemctl daemon-reload

# Включаем автозапуск и стартуем сейчас
sudo systemctl enable 1c-crserver
sudo systemctl start 1c-crserver

# Проверяем, что служба "зеленая"
sudo systemctl status 1c-crserver
```

---

### Шаг 5. Как программисту создать само хранилище?
Теперь сервер работает и ждет подключений. Программист делает так:

1.  Открывает Конфигуратор своей базы.
2.  Меню: **Конфигурация -> Хранилище конфигурации -> Создать хранилище**.
3.  Путь: `tcp://IP_СЕРВЕРА:1542/НазваниеПроекта`
    *   *Например:* `tcp://10.46.101.22:1542/ERP_DEV`
4.  1С сама создаст папку `ERP_DEV` внутри твоего каталога `/var/1c/repos`.

---

### Почему это лучше, чем в твоей ссылке?

1.  **Безопасность:** Если хакер взломает хранилище, он будет "заперт" в пользователе `1c_repo`. Он даже не увидит файлы твоего основного кластера 1С, потому что у него нет прав на `/var/1c_cluster`.
2.  **Надежность:** Если процесс `crserver` упадет (например, из-за нехватки памяти), **systemd** сам поднимет его через 5 секунд (`Restart=always`).
3.  **Порядок:** Все логи хранилища и данные лежат в одном системном месте, а не разбросаны по домашним папкам.

Хранилище со временем растет. Чтобы оно не тормозило, раз в месяц проси программистов делать **«Сокращение истории хранилища»** (это делается из Конфигуратора). А ты не забывай раз в неделю делать бэкап папки `/var/1c/repos` (просто архивируй её), так как это **самые важные файлы** для разработчиков — там вся их работа за месяцы.
